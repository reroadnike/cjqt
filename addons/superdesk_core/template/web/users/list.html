{template 'common/header'}
<!--<ul class="nav nav-tabs">-->
    <!--<li class="active">-->
        <!--<a href="#">项目管理员管理</a>-->
    <!--</li>-->
<!--</ul>-->

<div class="alert alert-warning" role="alert">
    注意：
    <!--<p>1.商家管理员,不分物业、小区,是根据定位显示附近商家。（在小区设置->lbs定位设置距离）</p>-->
    <!--<p>2.超市管理员,分所属物业和独立小区,添加操作员时,只选择物业,超市商品在该物业下的所有小区所见。如选择物业后又选择小区,只在该小区下所见。</p>-->
    <p>1.项目管理员,分属项目和企业。</p>
</div>
<div class="main">
    <div class="panel panel-default">
        <div class="panel-heading">
            项目管理员
        </div>
        <div class="panel-body">
            <div style="padding:15px;">
                <table class="table table-hover table-condensed">
                    <thead class="navbar-inner">
                        <tr>
                            <th style="width:5%;">uid</th>
                            <th style="width:15%;">用户名</th>
                            <th style="width:15%;">所属项目</th>
                            <th style="width:15%;">所属企业</th>
                            <th style="width:5%;">状态</th>
                            <th style="width:15%;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {loop $permission $user}
                        <tr>
                            <td>{$user['uid']}</td>
                            <td>{$member[$user['uid']]['username']}</td>
                            <td>{$user['organization_code']}</td>
                            <td>{$user['virtual_code']}</td>
                            <td><label data="{$member[$user['uid']]['status']}" class='label label-default {if $member[$user['uid']]['status']==2}label-info{else}{/if}' onclick="setProperty(this,{$user['uid']},'status')">{if $member[$user['uid']]['status']==2}启用{else}禁用{/if}</label></td>
                            <td>
                                <span>
                                    <a href="#" onclick="addUser({$user['uid']})" title="" data-toggle="tooltip" data-placement="top" class="btn btn-default btn-xs" data-original-title="编辑"><i class='glyphicon glyphicon-edit'></i>&nbsp;编辑</a>
                                </span>
                                <span>
                                    <!--
                                    <a href="{php echo $this->createWebUrl('users',array('op' => 'menu','id' => $user['id']));}" title="" data-toggle="tooltip" data-placement="top" class="btn btn-default btn-xs" data-original-title="设置权限"><i class='glyphicon glyphicon-plus'></i>&nbsp;设置权限</a>
                                    -->
                                    <a href="{php echo $this->createWebUrl('users_permission',array('uid' => $user['uid'],'id' => $user['id']));}" title="" data-toggle="tooltip" data-placement="top" class="btn btn-default btn-xs" data-original-title="设置权限"><i class='glyphicon glyphicon-plus'></i>&nbsp;设置权限</a>
                                </span>
                                <span>
                                    <a href="{php echo $this->createWebUrl('users',array('op' => 'commission','id' => $user['id']));}" title="" data-toggle="tooltip" data-placement="top" class="btn btn-default btn-xs" data-original-title="设置权限"><i class='glyphicon glyphicon-plus'></i>&nbsp;设置分成</a>
                                </span>
                                <span>
                                    <a onclick="return confirm('删除操作不可恢复，确认吗？'); return false;" href="{php echo $this->createWebUrl('users',array('op'=>'delete','uid'=>$user['uid']))}" title="" data-toggle="tooltip" data-placement="top" class="btn btn-default btn-xs" data-original-title="删除"><i class="fa fa-times"></i>删除</a>
                                </span>
                                
                            </td>
                        </tr>
                        {/loop}
                        <tr>
                            <td>
                                <!--<input name="submit" type="submit" class="btn btn-primary" value="提交">-->
                                <!--共{$total}条-->
                                <input type="hidden" name="token" value="{$_W['token']}"/>
                            </td>
                            <td colspan="4">
                                {$pager}
                            </td>
                            <td style="text-align: right;">
                                <a class="btn btn-default btn-xs" href="#" onclick="addUserPanel(this)"><i class='glyphicon glyphicon-plus'></i>&nbsp;添加项目管理员</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>
<script type="text/javascript">
    function addUserPanel() {
        require(['util'], function (util) {
            util.ajaxshow("{php echo $this->createWebUrl('users',array('op' => 'add'));}", '添加项目管理员', {
                'width': 800
            });
        });
    }
    function addUser(id) {
        var id = id;
        require(['util'], function (util) {
            util.ajaxshow("{php echo $this->createWebUrl('users',array('op' => 'add'));}&uid=" + id, '修改项目管理员', {
                'width': 800
            });
        });
    }
    function setProperty(obj, uid, type) {
        $(obj).html($(obj).html() + "...");
        $.post("{php echo $this->createWebUrl('users',array('op' => 'set'))}"
                , {uid: uid, type: type, data: obj.getAttribute("data")}
                , function (d) {
                    $(obj).html($(obj).html().replace("...", ""));
                    if (type == 'status') {
                        $(obj).html(d.data == '2' ? '启用' : '禁用');
                    }
                    $(obj).attr("data", d.data);
                    if (d.result == 1) {
                        $(obj).toggleClass("label-info");
                    }
                }
                , "json"
        );
    }
</script>
{template 'common/footer'} 