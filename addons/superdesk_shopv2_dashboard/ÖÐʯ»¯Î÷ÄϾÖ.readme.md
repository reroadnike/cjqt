

### 来路信息验证

 西南油气分公司

中石化西南局电商对接安全身份认证方案
（V1.0）

编制部门：	信息中心
编 写 人：	XXX	编制时间：	2019/5/14
审 查 人：	XXX	审定时间：	2019/5/15




二〇一九年五月


文档名称	中石化西南局电商对接安全身份认证方案	
文档类别	设计方案	
文档编号	RJKF-SSFA-01	版本号	1.0
版本变更记录
版本	文档时间	变更说明
1.0	2019/5/14	文档初始
		
		
		
		
		
		
		
		
		






目录
一、背景	1
1.1、建设背景	1
1.2、建设内容	1
二、方案设计	1
2.1、接口协议	1
2.2、系统间身份认证	1

一、背景
1.1、建设背景
1.2、建设内容
二、方案设计
2.1、接口协议
针对中石化一卡通平台与第三方电商平台接口调用统一使用HTTPS通信协议
2.2、系统间身份认证
身份认证分为两步第一步利用rsa进行参数加密解密，第三方利用rsa公钥进行解密获取明文参数，第二步利用解密的明文参数与签名参数做一个防篡改的校验。
1 RSA参数加密解密
RSA加密算法是一种非对称加密算法。在公开密钥加密和电子商业中RSA被广泛使用。通常是先生成一对RSA 密钥，其中之一是保密密钥，由一卡通平台保存；另一个为公开密钥，可对第三方电商平台保存，在调用第三方平台接口时候使用私钥加密传递到第三方平台后，电商平台用公钥进行解密，得到明文参数
2 签名参数校验防篡改
在使用http或者soap传输数据的时候，签名作为其中一个参数，可以起到关键作用：
1）、鉴权（通过客户的密钥，服务端的密钥匹配）。
2）、数据防篡改（参数是明文传输，将参数及密钥加密作为签名与服务器匹配）。
下面来分析下具体的方式：
将请求参数中的各个键值对按照key的字符串顺序升序排列（大小写敏感），把key和value拼成一串之后最后加上密钥，组成key1value1key2value2PRIVATEKEY的格式，转成utf-8编码的字节序列后计算md5，作为请求的签名。计算出来的签名串应当全为小写形式。如果某个参数的值为空，则此参数不参与签名。
下面举个例子。假设参数列表为：
username 帐号
money	金额
uuid	 ssssfsdfadfdsfsda
假设密钥为：Sinopec201905
则待签名的明文为：username帐号money金额uuidssssfsdfadfdsfsda Sinopec201905
将明文按utf-8取字节序列，并计算md5假设为：332ce52ed0a9686cc32bdd0eb45de577
客户端接收到明文参数为username=帐号&money=金额&uuid=ssssfsdfadfdsfsda&&sign =332ce52ed0a9686cc32bdd0eb45de577
通过username帐号money金额uuidssssfsdfadfdsfsdaSinopec201905进行md5加密获取密文与sign参数进行对比，防止参数被篡改。
注：因为md5加密是不可逆的，在服务端取到参数后按同样的规则进行匹配，起到了鉴权及数据完整性的作用。
