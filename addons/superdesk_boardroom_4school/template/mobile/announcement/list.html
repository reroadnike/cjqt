<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" type="text/css" href="{MODULE_URL}template/mobile/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="{MODULE_URL}template/mobile/css/weui.css" />
    <link rel="stylesheet" type="text/css" href="{MODULE_URL}template/mobile/css/css.css"/>
    <link rel="stylesheet" type="text/css" href="{MODULE_URL}template/mobile/css/region.css" />
    <!--组件依赖js begin-->
    <script type="text/javascript" src="{MODULE_URL}static/js/zepto.js"></script>
    <script type="text/javascript" src="{MODULE_URL}static/js/zepto.extend.js"></script>
    <script type="text/javascript" src="{MODULE_URL}static/js/zepto.ui.js"></script>
    <script type="text/javascript" src="{MODULE_URL}static/js/zepto.fix.js"></script>
    <!--刷新-->
    <script type="text/javascript" src="{MODULE_URL}static/js/refresh.js"></script>
    <title>{$region['title']}</title>
    <style type="text/css">
        .tab_title {
            padding: 0px;
            width: 100%;
            display: -moz-box;
            display: -webkit-box;
        }

        .tab_title a {
            display: block;
            -webkit-box-flex: 1;
            -moz-box-flex: 1;
            text-align: center;
            height: 40px;
            line-height: 40px;
            font-size: .7rem;
            background-color: white;
        }

        .tab_title a:last-child {
            border-right: none;
        }

        .tab_title a.active {
            /*color: #EB233F;*/
            font-size: .7rem;
            /*background: url({MODULE_URL}template/mobile/images/hongjiao.png) 0px 0px no-repeat #fff;*/
            /*background-size: 16px;*/
            border-bottom: 2px solid #1b37a8;
        }

        #btn_div {
            position: fixed;
            height: 50px;
            z-index: 990;
            right: 0px;
            bottom: 120px;
        }

        .btn_img {
            background:url({MODULE_URL}template/mobile/images/menu_btn.png) no-repeat;
            width: 30px;
            height: 30px;
            background-size: 30px;
            display: inline-block;
            margin: 10px;
            -webkit-transition: all 0.2s ease-out;
            -moz-transition: all 0.2s ease-out;
        }

        #btn_dj {
            height: 50px;
            width: 50px;
            /*background: #48b54e;*/
            position: absolute;
            right: 0px;
            top: 0px;
            z-index: 100;
        }

        .menu_btn {
            height: 50px;
            padding: 5px 0px 5px 5px;
            font-size: 14px;
            /*background: #48b54e;*/
            color: #fff;
            position: absolute;
            /*right: 50px;*/
            width: 100%;
            -webkit-transition: all 0.5s ease-out;
            -moz-transition: all 0.5s ease-out;
            z-index: 80;
            border-radius:5px ;
        }

        .menu_btn a {
            display: inline-block;
            /*color: #fff;*/
            /*border-right: 1px solid #fff;*/
            text-align: center;
            width: 50%;
            height: 100%;
            line-height: 40px;

        }

        .hide_b {
            -moz-transform: rotate(0deg);
            -webkit-transform: rotate(0deg);
        }

        .show_b {
            -moz-transform: rotate(-45deg);
            -webkit-transform: rotate(-45deg);
        }

        .hide_m {
            -moz-transform: translateX(297px);
            -webkit-transform: translateX(297px);
            opacity: 0;
        }

        .show_m {
            -moz-transform: translateX(0px);
            -webkit-transform: translateX(0px);
            opacity: 1;
        }
        /*加载*/

        .ui-refresh-down {
            height: 42px;
            /*border-top: 1px solid #e4e4e4;*/
            border-bottom: 1px solid #e4e4e4;
            line-height: 42px;
            background: #f0f0f0;
            text-align: center;
        }

        .ui-refresh-icon {
            display: inline-block;
            content: '';
            background:url({MODULE_URL}template/mobile/images/arrow-down.png) no-repeat;
            width: 12px;
            background-size: 12px;
            height: 7px;
            margin-right: 5px;
        }

        .ui-refresh-icon {
            display: inline-block;
            content: '';
            background:url({MODULE_URL}template/mobile/images/arrow-down.png) no-repeat;
            width: 12px;
            background-size: 12px;
            height: 7px;
            margin-right: 5px;
        }

        .ui-loading {
            display: inline-block;
            content: '';
            background:url({MODULE_URL}template/mobile/images/loading.gif) no-repeat;
            width: 16px;
            background-size: 16px;
            height: 16px;
            margin-right: 5px;
        }
        .rank{
            text-align:center;
            color:white;
            background-color:#48b54e;
            width:50px;
            font-size:12px;
            height:20px;
            line-height:20px;
            border-radius: 2px;

        }
        .del{
            width:50px;
            height:20px;
            line-height:20px;
            font-size:12px;
            margin-right: 2px;
            background-color:#dfdfdf;
            border-radius: 2px;
            text-align:center;
        }

        p.weui_cell_ann {
            margin-right: 10px;
            color: white;
            width: 50px;
            height: 20px;
            border-radius: 5px;
            font-size: .6rem;
            text-align: center;
            line-height: 20px;
            float: left
        }
        p.weui_cell_ann_read_ed{
            background-color:#90A0E3;
        }
        p.weui_cell_ann_read_ye{
            background-color:#F26D6F;
        }
    </style>
</head>

<body>
<header id="header">
    <div class="header_div">
        <div id="left_div" onClick="window.location.href='{php echo $this->createMobileUrl('profile')}'"></div>
        <div id="middle_div">
            <h1 id="title">公告列表</h1></div>
        <div id="right_div">
            <div class="right_bottom"></div>
            <div class="right_img"></div>
        </div>
    </div>
</header>
<!--cont-->
<div class="cont">
    <!--
    <aside class="setup">
        <span class="aff_title">全部公告</span><a href="#">全部设置已读</a>
    </aside>
    -->
    <div class="ui-refresh" id="repair">
        <div class="weui_cells weui_cells_access" id="data-list" >
        </div>
        <div class="ui-refresh-down"></div>
    </div>
</div>
<script type="text/javascript">
/*ajax请求函数,判断共几页，呈现不同效果*/
(function() {
    xqAjax();
    function xqAjax() {
        var url = "{php echo $this->createMobileUrl('announcement',array('op' => 'list'))}";
        $.ajax({
            url: url,
            async: false,
            type: 'post',
            dataType: 'json',
            data: {},
            beforeSend: function () {
                $("#data-list").html("<div class='seach_loading'><img src='{MODULE_URL}template/mobile/images/loading.gif'/>为您搜索中</div>")
            },
            success: function (data) {
                console.log(data);
                var $list = $('#data-list'),
                    html = (function (data) { //数据渲染
                        var liArr = [];
                        $.each(data.allhtml, function () {
                            liArr.push(this.html);
                        });
                        return liArr.join('');
                    })(data);

                $('#data-list').html(html)
                if (data.page_count < 2) {
                    $(".ui-refresh-down").html("<span class='ui-refresh-label'>没有更多内容了</span>");
                } else {
                    refreshFun();
                }
            },
            error: function () {
                alert('请求不到数据，请重新搜索！');
            }

        })
    }

    /*组件初始化refreshFun函数*/

    function refreshFun() {
        var index = 1;
        $('.ui-refresh').refresh({
            ready: function (dir, type) {
                var me = this;
                index++;
                $.getJSON("{php echo $this->createMobileUrl('announcement',array('op' => 'list'))}", {
                    page: index,

                }, function (data) {
                    var $list = $('.data-list'),
                            html = (function (data) { //数据渲染
                                var liArr = [];
                                $.each(data.allhtml, function () {
                                    liArr.push(this.html);
                                });
                                return liArr.join('');
                            })(data);

                    $list[dir == 'up' ? 'prepend' : 'append'](html);
                    if (index < data.page_count) {
                        me.afterDataLoading();
                    } else {
                        me.disable(dir, false);
                    }
                });
            }
        });

    }
    /*组件初始化js end*/
})();
</script>
</body>
</html>


