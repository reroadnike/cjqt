{template '__header'}
<!--
<div class="pagetoplogo"></div>
<div class="pagebottomlogo"></div>
-->

<link rel="stylesheet" type="text/css" href="{MODULE_URL}template/mobile/css/orderList.css" />

<div class="navlist">
    <!-- 选中添加类名 navitemsel-->

    <a href="{php echo murl('entry' , array('m'=>'superdesk_boardroom_4school' , 'do'=>'myorder' , 'status' => 999))}" class="navitem {if $status == 999}navitemsel{/if}">
        <span>全部</span>
    </a>
    <a href="{php echo murl('entry' , array('m'=>'superdesk_boardroom_4school' , 'do'=>'myorder' , 'status' => 1))}" class="navitem {if $status == 1}navitemsel{/if}">
        <span>待审核</span>
    </a>
    <a href="{php echo murl('entry' , array('m'=>'superdesk_boardroom_4school' , 'do'=>'myorder' , 'status' => 3 , 'is_overdue' => 0))}" class="navitem {if $status == 3 && $is_overdue == 0}navitemsel{/if}">
        <span>已审核</span>
    </a>
    <a href="{php echo murl('entry' , array('m'=>'superdesk_boardroom_4school' , 'do'=>'myorder' , 'status' => 3 , 'is_overdue' => 1))}" class="navitem {if $status == 3 && $is_overdue == 1}navitemsel{/if}">
        <span>已使用</span>
    </a>
    <a href="{php echo murl('entry' , array('m'=>'superdesk_boardroom_4school' , 'do'=>'myorder' , 'status' => '-1'))}" class="navitem {if $status == -1}navitemsel{/if}">
        <span>已取消</span>
    </a>
</div>
<div class="orderwrap">
    <ul class="orderlist">

        {if $total == 0}
        <li style="width: 100%;height: 100%;background: url({MODULE_URL}template/mobile/images/error/none_order.png) 50% 25% no-repeat;position: fixed;"></li>
        {else}

        {loop $my_boardroom_appointment $index $item}
        <li class="orderlistitem clearfix">

            <div class="orderlistimg" style="background: url({$_W['siteroot']}thumbnail/timthumb.php?src={php echo tomedia($item['boardroom']['thumb'])}&h=200&w=200&zc=1) center center no-repeat;background-size: auto 100%;"></div>
            <div class="orderinfotop">
                <h3 class="ellipsis">
                    <a style="color: #333;" href="{php echo murl('entry' , array('m'=>'superdesk_boardroom_4school' , 'do'=>'boardroom_booking_detail' , 'out_trade_no' => $item['out_trade_no']))}">
                        {$item['boardroom']['name']}
                    </a>
                </h3>
                <!-- 待付款/使用中（添加类名为textcolor） 已完成不加类名-->
                <span class="textcolor">
                    {if $item['status'] == 0}
                    待审核
                    {elseif $item['status'] == 1}
                    待审核
                    {elseif $item['status'] == 3}
                    已审核
                    {elseif $item['status'] == -1}
                    已取消
                    {/if}
                </span>
            </div>
            <div class="orderroominfo">
                <span>容纳人数：{$item['boardroom']['max_num']}人</span>
                <!--<span>楼层：{$item['boardroom']['floor']}层</span>-->
            </div>
            <div class="orderroomprice">
                <!--
                <span>{$item['price']} 元/时</span>
                <span>x {$item['quantity']} 小时</span>
                -->
                <em class="roomdesk">
                    <i class="deskicon"></i>
                    <span>20</span>
                    <i class="sofaicon"></i>
                    <span>20</span>
                </em>
                <a style="color: #333;" href="{php echo murl('entry' , array('m'=>'superdesk_boardroom_4school' , 'do'=>'boardroom_booking_detail' , 'out_trade_no' => $item['out_trade_no']))}">
                <strong href="javascript: void(0);" title="详情" class="detail_order" data-id="{$item['id']}">详情</strong>
                </a>
                <!-- 只有已审核/待审核可以取消订单 -->
                {if $item['status'] == 0}
                <strong href="javascript: void(0);" title="取消订单" class="cancelorder" data-id="{$item['id']}">取消订单</strong>
                {elseif $item['status'] == 1}
                <strong href="javascript: void(0);" title="取消订单" class="cancelorder" data-id="{$item['id']}">取消订单</strong>
                {elseif $item['status'] == 3}
                <strong href="javascript: void(0);" title="取消订单" class="cancelorder" data-id="{$item['id']}">取消订单</strong>
                {elseif $item['status'] == -1}

                {/if}

            </div>

        </li>
        {/loop}

        {/if}

    </ul>
</div>
<div style="width: 100%;height: 1rem;">&nbsp;</div>
<div style="width: 100%;height: 1rem;">&nbsp;</div>
<script type="text/javascript">

    $(".cancelorder").each(function(index,element){
        var that_id = $(this).data("id");
        $(this).bind('click', function(event) {
            $.post(
                "{$url_ajax_boardroom_appointment_cancel}",
                {id : that_id},
                function (data, status) {
                    console.log("Data: " + data + "\nStatus: " + status);
                    data = JSON.parse(data);
                    $.alert({
                        title: '提示',
                        content: data.msg,
                    });
                    if(data.data == 1){
                        console.log("{php echo referer()}");
                        window.location.href='';
                    }
                }
            );
        });
    });
</script>
{template '__nav__'}
{template '__footer'}